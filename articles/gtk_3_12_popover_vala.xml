<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../xsl/article.xsl"?>
<!DOCTYPE article SYSTEM "http://philipp.feige-trommler.de/dtd/article.dtd">
<article itemscope="" itemtype="http://schema.org/BlogPosting" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
	<meta property="og:title" content="Die neuen GTK 3.12 Popover in Vala - Philipp Trommler - Blog"/>
	<meta itemprop="description" property="og:description" content="Die neuen Popovers aus GTK 3.12 sollen die klassischen Menüs ersetzen, denn sie sehen besser aus und bilden ein konsistentes Design mit den Menüs der GNOME Shell. Zudem sind sie sehr flexibel: in ihnen können viele verschiedene Widgets platziert werden."/>
	<meta property="og:type" content="article"/>
	<meta itemprop="datePublished" property="article:published_time" content="2014-04-24T21:05:00+02"/>
	<meta property="article:author" content="philipp.trommler"/>
	<meta property="article:section" content="Technology"/>
	<meta property="article:tag" content="3.12"/>
	<meta property="article:tag" content="GTK"/>
	<meta property="article:tag" content="Vala"/>
	<meta property="article:publisher" content="philipp.trommler"/>
	<meta property="fb:admins" content="philipp.trommler"/>
	<meta property="fb:profile_id" content="philipp.trommler"/>
	<meta itemprop="thumbnailUrl" property="og:image" content="http://philipp.feige-trommler.de/images/articles/popover1.png"/>
	<meta itemprop="url" property="og:url" content="http://philipp.feige-trommler.de/articles/gtk_3_12_popover_vala.xml"/>
	<meta itemprop="inLanguage" property="og:locale" content="de_DE"/>
	<meta property="og:site_name" content="Philipp Trommler - Blog"/>
	<time datetime="2014-04-24T21:05:00+02">Thu, 24 Apr 2014 21:05 +0200</time>
	<link rel="canonical" href="http://philipp.feige-trommler.de/articles/gtk_3_12_popover_vala.xml"/>
	<author>Philipp Trommler<a href="https://plus.google.com/+PhilippTrommler" rel="author"/></author>
	<title>Die neuen GTK 3.12 Popover in Vala - Philipp Trommler - Blog</title>
	<h3 itemprop="headline">Die neuen GTK 3.12 Popover in Vala</h3>
	<text itemprop="articleBody">
		<p>Die neuen Popovers aus GTK 3.12 sollen die klassischen Menüs ersetzen, denn sie sehen besser aus und bilden ein konsistentes Design mit den Menüs der GNOME Shell. Zudem sind sie sehr flexibel: in ihnen können viele verschiedene Widgets platziert werden.</p>
		<h4>Minimalbeispiel</h4>
		<img src="../images/articles/popover1.png" alt="GTK Popover im Minimalbeispiel aus dem letzten Tutorial" height="475" width="476">
			<caption>GTK Popover im Minimalbeispiel aus dem letzten Tutorial.</caption>
		</img>
		<p>Wie schon im <a href="gtk_3_10_headerbar_vala.xml" target="_blank">letzten Tutorial</a> zu HeaderBars, will ich euch die Verwendung der Popovers an einem Minimalbeispiel näherbringen. Das oben gezeigte Programm kann mit dem nur um einige Zeilen erweiterten Quelltext aus dem HeaderBar-Tutorial erzeugt werden:</p>
		<code lang="vala"><![CDATA[class Example : Gtk.Application {
	public Example () {
		Object (application_id: "com.example.app", flags: ApplicationFlags.FLAGS_NONE);
	}

	protected override void activate () {
		Gtk.ApplicationWindow window = new Gtk.ApplicationWindow (this);
		window.set_default_size (500, 500);
		
		/*
		 * HeaderBar - siehe letztes Tutorial
		 */
		
		Gtk.HeaderBar headerBar = new Gtk.HeaderBar ();
		headerBar.set_show_close_button (true);
	
		Gtk.Entry entry = new Gtk.Entry ();
		entry.set_icon_from_icon_name (Gtk.EntryIconPosition.PRIMARY, "system-search");
		headerBar.set_custom_title (entry);
	
		Gtk.Button openButton = new Gtk.Button.from_icon_name ("document-open", Gtk.IconSize.LARGE_TOOLBAR);
		headerBar.pack_start (openButton);
	
		Gtk.Button closeButton = new Gtk.Button.from_icon_name ("document-save-as", Gtk.IconSize.LARGE_TOOLBAR);
		headerBar.pack_end (closeButton);
	
		window.set_titlebar (headerBar);
		
		/*
		 *	Ab hier Popover
		 */
		
		GLib.SimpleAction test = new GLib.SimpleAction ("test", null);
		this.add_action (test);
		
		GLib.Menu menu = new GLib.Menu ();
		menu.append ("Test", "test");
		
		Gtk.Popover pop = new Gtk.Popover (closeButton);
		pop.bind_model (menu, "app");
		
		closeButton.clicked.connect (() => {
			pop.set_visible (true);
		});
		
		window.show_all ();
	}
}

int main (string[] args) {
	return new Example ().run (args);
}]]></code>
		<p>Drei Dinge sind hierbei besonders zu beachten:
		<ul>
			<li>Ein Popover ist immer einem Widget zugeordnet, das dem Konstruktor übergeben wird. Hiervon ist auch die Ausrichtung des Popovers abhängig, die allerdings auch nachträglich geändert werden kann.</li>
			<li>Ein Popover darf nicht gleich beim Öffnen des Fensters gezeigt werden, dies führt zu Fehlverhalten. Erst nachträglich sollte es in einem Event-listener mit <inlinecode>set_visible (true)</inlinecode> gezeigt werden. Um das Verbergen des Popovers muss man sich nicht kümmern, es erfolgt automatisch.</li>
			<li>Wird ein Menü an das Popover gebunden, werden Menüeinträge, zu denen keine <inlinecode>GLib.Action</inlinecode> gefunden wird, ausgegraut und inaktiv. Dafür erwartet die Funktion <inlinecode>bind_model</inlinecode> als zweiten Parameter ein Präfix, das allen Aktionen vorangestellt wird. Diese Präfixe werden automatisch durch <inlinecode>add_action</inlinecode> erzeugt und lauten <inlinecode>app</inlinecode>, wenn die Aktion der <inlinecode>Gtk.Application</inlinecode> zugeordnet wird, und <inlinecode>win</inlinecode>, wenn sie einem <inlinecode>Gtk.Window</inlinecode> zugeordnet wird.</li>
		</ul></p>
		<p>Am Befehl für die Kompilierung hat sich natürlich nichts geändert: Einfach als <inlinecode>popover.vala</inlinecode> speichern und mit</p>
		<code lang="bash"><![CDATA[valac --pkg gtk+-3.0 -o popover popover.vala]]></code>
		<p>kompilieren. Zu beachten ist, dass die aktuellen Versionen <inlinecode>libgtk-3-0</inlinecode> und <inlinecode>libgtk-3-dev (>= 3.12)</inlinecode> benötigt werden, um das Programm zu übersetzen.</p>
		<h4>Aufhübschen!</h4>
		<p>Damit die Menüeinträge ein bisschen mehr her machen, können sie mit Icons versehen werden, dafür muss das <inlinecode>menu.append ()</inlinecode> durch ein <inlinecode>menu.append_item ()</inlinecode> ersetzt und die entsprechenden Menü-Items gebaut werden:</p>
		<code lang="vala"><![CDATA[GLib.SimpleAction save = new GLib.SimpleAction ("save", null);
save.activate.connect (() => {
	// Datei speichern
});
this.add_action (save);

GLib.MenuItem saveItem = new GLib.MenuItem ("Speichern", "save");
saveItem.set_icon (new GLib.ThemedIcon ("document-save"));

GLib.SimpleAction save_as = new GLib.SimpleAction ("save_as", null);
save_as.activate.connect (() => {
	// Datei speichern unter
});
this.add_action (save_as);

GLib.MenuItem saveAsItem = new GLib.MenuItem ("Speichern unter", "save_as");
saveAsItem.set_icon (new GLib.ThemedIcon ("document-save-as"));

GLib.Menu menu = new GLib.Menu ();
menu.append_item (saveItem);
menu.append_item (saveAsItem);]]></code>
		<p>Das funktioniert zwar, allerdings entspricht das Ergebnis wohl nicht ganz dem, was der Benutzer von einem Popover erwartet:</p>
		<img src="../images/articles/popover2.png" alt="Nicht ganz passend, aber möglich: Icons im GTK Popover" height="475" width="476">
			<caption>Nicht ganz passend, aber möglich: Icons im GTK Popover.</caption>
		</img>
		<h4>Auswahl</h4>
		<p>Ein besonders passender Anwendungsfall für Popover sind Auswahlmöglichkeiten, die das Verhalten eines anderes Widgets beeinflussen, da sie genau hierfür konzipiert wurden: Sie sollen eine Möglichkeit bieten, einfache und häufig geänderte Einstellungen 'an Ort und Stelle' erreichbar zu machen.</p>
		<p>Sehen wir uns also das Suchfeld - welches im Übrigen der Aktualität halber durch ein <inlinecode>Gtk.SearchEntry</inlinecode> ersetzt wurde - der Beispielanwendung an: Vorstellbar ist zum Beispiel, dass es eine Auswahlmöglichkeit gibt, ob im Internet oder nur lokal gesucht werden soll. Dies lässt sich leicht durch die Verwendung einer <inlinecode>Gtk.Box</inlinecode> oder eines <inlinecode>Gtk.Grid</inlinecode> erreichen:</p>
		<code lang="vala"><![CDATA[Gtk.Grid search_grid = new Gtk.Grid ();
search_grid.set_column_spacing (10);
search_grid.set_margin_top (10);
search_grid.set_margin_end (10);
search_grid.set_margin_bottom (10);
search_grid.set_margin_start (10);

Gtk.Label search_label = new Gtk.Label ("Im Internet suchen");
search_grid.attach (search_label, 0, 0, 1, 1);

Gtk.Switch search_switch = new Gtk.Switch ();
search_grid.attach (search_switch, 1, 0, 2, 1);

search_grid.show_all ();

Gtk.Popover search_pop = new Gtk.Popover (entry);
search_pop.add (search_grid);

entry.enter_notify_event.connect ((e) => {
	search_pop.set_visible (true);
	return true;
});]]></code>
		<img src="../images/articles/popover3.png" alt="Auch Gtk.Box und Gtk.Grid sind im Popover möglich" height="475" width="476">
			<caption>Auch Gtk.Box und Gtk.Grid sind im Popover möglich.</caption>
		</img>
		<p>Über diese Container sind natürlich sehr komplexe Inhalte für Popover möglich, fast alle Widgets, die in eine <inlinecode>Gtk.Box</inlinecode> oder ein <inlinecode>Gtk.Grid</inlinecode> gepackt werden können, können somit auch Inhalt eines Popover werden.</p>
		<p>In diesem Sinne viel Spaß mit dieser neuen Fähigkeit von GTK und erfolgreiches Coden!</p>
	</text>
</article>
